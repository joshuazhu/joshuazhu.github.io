<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><title>web全栈工程师自我修养 1 高性能网站关键:缓存</title><link rel="stylesheet" href="/css/layout.css" type="text/css">
<link rel="stylesheet" href="/css/main.css" type="text/css"><link rel="shortcut icon" href="/img/favicon.png"></head><body><header class="base-menu"><div class="menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Josh ZHU</a></li><li class="menu-item"><a href="/Categories" class="menu-link">Categories</a></li></ul></nav></div></header><header class="base-mobile-menu"><div class="mobile-menu-wrapper"><div class="menu-layout-bg"></div><nav class="menu-content"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Josh ZHU</a></li><li class="menu-item"><a href="/Categories" class="menu-link">Categories</a></li></ul></nav><div id="mobile-menu-toggle" class="toggle-menu"><span class="menu-bar"></span><span class="menu-bar"> </span><span class="menu-bar"></span></div></div></header><div class="base-content"><div class="base-content-main"><article class="article-main"><h1 class="article-title">web全栈工程师自我修养 1 高性能网站关键:缓存</h1><div class="article-meta"><p class="meta-item meta-time"><span class="meta-item-title">发表于: </span>2016-04-25</p><p class="meta-item meta-category"><span class="meta-item-title">分类于: </span><a href="/categories/Self-improvement/" target="_blank" class="category-link">Self improvement</a></p></div><div class="article-content"><h2 id="1-数据库查询缓存"><a href="#1-数据库查询缓存" class="headerlink" title="1. 数据库查询缓存"></a>1. 数据库查询缓存</h2><p>Mysql 缓存</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--SIZE: 缓存块大小，默认值为0</span></span><br><span class="line">query_cache_size = SIZE</span><br><span class="line"></span><br><span class="line"><span class="comment">-- OPTION： 查询缓存类型 </span></span><br><span class="line"><span class="comment">-- 0 =&gt; 不缓存</span></span><br><span class="line"><span class="comment">-- 1 =&gt; 缓存除 SELECT S_NO_CACHE 之外的所有结果</span></span><br><span class="line"><span class="comment">-- 2 =&gt; 只缓存 SELECT SQL_CACHE 开始的查询结果</span></span><br><span class="line">query_cache_type = OPTION</span><br></pre></td></tr></table></figure>
<p><strong>注意:</strong><br>Mysql缓存只对两次SQL文本完全相同的查询才有效</p>
<h2 id="2-扩展数据库查询：-memcached"><a href="#2-扩展数据库查询：-memcached" class="headerlink" title="2. 扩展数据库查询： memcached"></a>2. 扩展数据库查询： memcached</h2><p>memcached是一个高性能分布式内存对象缓存系统。 普通数据库查询缓存的设计是： 只要表发生了<strong>更新操作，缓存就会失效</strong>。 不同的是，memcached的缓存是==<strong>按照时间过期的</strong>==。memcached存储时设置了一个过期时间，只要时间不到，程序就会从memcached中获取数据 （<strong>获得的数据并不是最“新鲜”的</strong>）。</p>
<h2 id="3-文件缓存"><a href="#3-文件缓存" class="headerlink" title="3.文件缓存"></a>3.文件缓存</h2><p>可以将频繁访问的数据存在文件中。文件缓存可以作为内存缓存的补充，访问顺序为： <strong>内存缓存-&gt;文件缓存-&gt;数据库</strong>。</p>
<h2 id="4-静态化"><a href="#4-静态化" class="headerlink" title="4.静态化"></a>4.静态化</h2><p>两种方法：</p>
<ol>
<li>Wordpress静态化插件：对每一篇新文章时自动生成静态页面</li>
<li>服务器每次接收到对这个页面的请求，就给出这个页面的静态文件。</li>
</ol>
<p>优点：</p>
<ol>
<li>加快访问速度</li>
<li>减轻服务器压力</li>
<li>抵御DDoS攻击</li>
</ol>
<h2 id="5-浏览器缓存"><a href="#5-浏览器缓存" class="headerlink" title="5.浏览器缓存"></a>5.浏览器缓存</h2><p>浏览器可以根据HTTPS头部中的指令来缓存数据，一般有两种办法：</p>
<ol>
<li>Expire<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expires: Thu, 15 Apr 2020 20:00:00 GMT</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>浏览器发送请求从缓存中获取数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">200 (from <span class="operator"><span class="keyword">cache</span>)</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li>Last-Modified<br>对有可能过期的请求，<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Last-Modified: Tue, 01 Mar 2015 03:42:36 GMT</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>如果3月10号浏览器命中了这个资源，就会发起一个HTTP请求去询问服务器，该资源是否被修改。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Modified-Since: Tue, 01 Mar 2015 03:42:36 GMT</span><br></pre></td></tr></table></figure></p>
<p>如果服务器回答<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//没有被修改</span><br><span class="line">304</span><br></pre></td></tr></table></figure></p>
<p>说明该资源没有被更新，浏览器可以直接使用缓存资源。这样的好处是服务器只需要发送一个HTTPS头部，而不需要把文件内容发送回去。<br>如果修改了，服务器回答<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//修改了</span><br><span class="line">200</span><br></pre></td></tr></table></figure></p>
<h2 id="6-Cache-Control"><a href="#6-Cache-Control" class="headerlink" title="6. Cache-Control"></a>6. Cache-Control</h2><ol>
<li>Expire, Cache-Control的设置是:max-age=77760000.</li>
<li><p>对于Last-Modified, Cache-Control的处理办法是修改query string</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://server/path/?query_string</span><br><span class="line"><span class="comment">-- 对于HTTP规范来说，修改了query string，就相当于请求一个新的文件。</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Best Practices</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.动态生成的HTML, HTTPS头：<span class="operator"><span class="keyword">Cache</span>-control: <span class="keyword">no</span>-<span class="keyword">cache</span>.</span><br><span class="line"><span class="number">2.</span>静态HTML页面，<span class="keyword">HTTP</span>头：<span class="keyword">Last</span>-Modified.</span><br><span class="line"><span class="number">3.</span>其他文件类型设置Expires头，并在文件内容有修改的时候修改<span class="keyword">Query</span> <span class="keyword">String</span>。</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</div></article><div id="base-discus"></div></div></div><footer class="base-footer"><div class="footer-wrapper"><span>Josh ZHU Using </span><a href="https://github.com/chuguixin/Simple"><span>Simple</span></a><span> Presents For You.</span></div></footer><div class="dom-ready"><script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script><script src="/js/base.js" type="text/javascript"></script></div></body></html>